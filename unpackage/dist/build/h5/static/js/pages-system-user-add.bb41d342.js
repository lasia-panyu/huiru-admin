(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-system-user-add"],{"5d7a":function(e,a,t){"use strict";var n=t("4ea4");t("4d63"),t("ac1f"),t("25f0"),Object.defineProperty(a,"__esModule",{value:!0}),a.filterToWhere=s,a.enumConverter=a.validator=void 0;var r=n(t("3835")),i=n(t("b85c")),l={username:{rules:[{format:"string"}],label:"用户名"},nickname:{rules:[{format:"string"}],label:"昵称"},gender:{rules:[{format:"int"},{range:[{text:"未知",value:0},{text:"男",value:1},{text:"女",value:2}]}],defaultValue:0,label:"性别"},status:{rules:[{format:"int"},{range:[{text:"正常",value:0},{text:"禁用",value:1},{text:"审核中",value:2},{text:"审核拒绝",value:3}]}],defaultValue:0,label:"用户状态"},mobile:{rules:[{pattern:"^\\+?[0-9-]{3,20}$"}],label:"手机号码"},email:{rules:[{format:"string"}],label:"邮箱"},role:{rules:[{format:"array"}],label:"角色"}};a.validator=l;var o={gender_valuetotext:{0:"未知",1:"男",2:"女"},status_valuetotext:{0:"正常",1:"禁用",2:"审核中",3:"审核拒绝"}};function s(e,a){var t={};for(var n in e){var l=e[n],o=l.type,s=l.value;switch(o){case"search":"string"===typeof s&&s.length&&(t[n]=new RegExp(s));break;case"select":if(s.length){var u,c=[],m=(0,i.default)(s);try{for(m.s();!(u=m.n()).done;){var d=u.value;c.push(a.eq(d))}}catch(_){m.e(_)}finally{m.f()}t[n]=a.or(c)}break;case"range":if(s.length){var f=s[0],v=s[1];t[n]=a.and([a.gte(f),a.lte(v)])}break;case"date":if(s.length){var b=(0,r.default)(s,2),p=b[0],h=b[1],g=new Date(p),x=new Date(h);t[n]=a.and([a.gte(g),a.lte(x)])}break;case"timestamp":if(s.length){var k=(0,r.default)(s,2),D=k[0],w=k[1];t[n]=a.and([a.gte(D),a.lte(w)])}break}}return t}a.enumConverter=o},"952d":function(e,a,t){"use strict";t.d(a,"b",(function(){return r})),t.d(a,"c",(function(){return i})),t.d(a,"a",(function(){return n}));var n={uniForms:t("5603").default,uniFormsItem:t("a927").default,uniDataPicker:t("70b7").default,uniEasyinput:t("7b6b").default,uniDataCheckbox:t("87bd").default},r=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("v-uni-view",{staticClass:"uni-container"},[t("uni-forms",{ref:"form",attrs:{value:e.formData,validateTrigger:"bind"}},[t("uni-forms-item",{attrs:{name:"department_id",label:"部门"}},[t("uni-data-picker",{attrs:{"self-field":"_id","parent-field":"parent_id",collection:"opendb-department",orderby:"name asc",field:"_id as value, name as text"},model:{value:e.formData.department_id,callback:function(a){e.$set(e.formData,"department_id",a)},expression:"formData.department_id"}})],1),t("uni-forms-item",{attrs:{name:"username",label:"柜员号"}},[t("uni-easyinput",{attrs:{placeholder:"柜员号，不允许重复",trim:"both"},model:{value:e.formData.username,callback:function(a){e.$set(e.formData,"username",a)},expression:"formData.username"}})],1),t("uni-forms-item",{attrs:{name:"gender",label:"性别"}},[t("uni-data-checkbox",{attrs:{localdata:e.formOptions.gender_localdata},model:{value:e.formData.gender,callback:function(a){e.$set(e.formData,"gender",a)},expression:"formData.gender"}})],1),t("uni-forms-item",{attrs:{name:"status",label:"用户状态"}},[t("uni-data-checkbox",{attrs:{localdata:e.formOptions.status_localdata},model:{value:e.formData.status,callback:function(a){e.$set(e.formData,"status",a)},expression:"formData.status"}})],1),t("uni-forms-item",{attrs:{name:"mobile",label:"手机号码"}},[t("uni-easyinput",{attrs:{placeholder:"手机号码",trim:"both"},model:{value:e.formData.mobile,callback:function(a){e.$set(e.formData,"mobile",a)},expression:"formData.mobile"}})],1),t("uni-forms-item",{attrs:{name:"email",label:"邮箱"}},[t("uni-easyinput",{attrs:{placeholder:"邮箱地址",trim:"both"},model:{value:e.formData.email,callback:function(a){e.$set(e.formData,"email",a)},expression:"formData.email"}})],1),t("uni-forms-item",{attrs:{name:"nickname",label:"昵称"}},[t("uni-easyinput",{attrs:{placeholder:"用户昵称",trim:"both"},model:{value:e.formData.nickname,callback:function(a){e.$set(e.formData,"nickname",a)},expression:"formData.nickname"}})],1),t("uni-forms-item",{attrs:{name:"role",label:"角色"}},[t("uni-data-checkbox",{attrs:{multiple:!0,collection:"uni-id-roles",field:"role_id as value, role_name as text"},model:{value:e.formData.role,callback:function(a){e.$set(e.formData,"role",a)},expression:"formData.role"}})],1),t("uni-forms-item",{attrs:{label:"密码"}},[t("uni-easyinput",{attrs:{placeholder:"密码",trim:"both"},model:{value:e.password,callback:function(a){e.password=a},expression:"password"}})],1),t("v-uni-view",{staticClass:"uni-button-group"},[t("v-uni-button",{staticClass:"uni-button",staticStyle:{width:"100px"},attrs:{type:"primary"},on:{click:function(a){arguments[0]=a=e.$handleEvent(a),e.submit.apply(void 0,arguments)}}},[e._v("提交")]),t("v-uni-navigator",{staticStyle:{"margin-left":"15px"},attrs:{"open-type":"navigateBack"}},[t("v-uni-button",{staticClass:"uni-button",staticStyle:{width:"100px"}},[e._v("返回")])],1)],1)],1)],1)},i=[]},"9a4c":function(e,a,t){"use strict";t.r(a);var n=t("952d"),r=t("e7b6");for(var i in r)"default"!==i&&function(e){t.d(a,e,(function(){return r[e]}))}(i);var l,o=t("f0c5"),s=Object(o["a"])(r["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],l);a["default"]=s.exports},"9e5a":function(e,a,t){"use strict";(function(e){var n=t("4ea4");t("caad"),t("b64b"),t("2532"),Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0,t("96cf");var r=n(t("1da1")),i=n(t("5530")),l=t("5d7a"),o=e.database();o.command;function s(e){var a={};for(var t in l.validator)e.includes(t)&&(a[t]=l.validator[t]);return a}var u={data:function(){var e={username:"",gender:0,status:0,mobile:"",email:"",department_id:["00001"],nickname:"",role:[]};return{password:"",formData:e,formOptions:{gender_localdata:[{text:"未知",value:0},{text:"男",value:1},{text:"女",value:2}],status_localdata:[{text:"正常",value:0},{text:"禁用",value:1},{text:"审核中",value:2},{text:"审核拒绝",value:3}]},rules:(0,i.default)({},s(Object.keys(e)))}},onReady:function(){this.$refs.form.setRules(this.rules)},methods:{submit:function(){var e=this;uni.showLoading({mask:!0}),this.$refs.form.validate().then((function(a){e.submitForm(a)})).catch((function(){uni.hideLoading()}))},submitForm:function(e){var a=this;return(0,r.default)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e._id=e.username,e.password=a.password,e.department_id=e.department_id[0],console.log(e),t.next=6,a.$util.cloudFunction("user","add",e);case 6:n=t.sent,0==n.code?(uni.showToast({title:"新增成功"}),a.getOpenerEventChannel().emit("refreshData"),setTimeout((function(){return uni.navigateBack()}),500)):uni.showModal({content:n.msg,showCancel:!1}),uni.hideLoading();case 9:case"end":return t.stop()}}),t)})))()}}};a.default=u}).call(this,t("a9ff")["default"])},e7b6:function(e,a,t){"use strict";t.r(a);var n=t("9e5a"),r=t.n(n);for(var i in n)"default"!==i&&function(e){t.d(a,e,(function(){return n[e]}))}(i);a["default"]=r.a}}]);